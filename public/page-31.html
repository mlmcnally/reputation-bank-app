<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Exercise 2 ‚Äì Page 31</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: "Avenir", "Nunito Sans", sans-serif;
      background: #f3f4f6;
      padding: 2rem;
      margin: 0;
      color: #000;
    }

    .header {
      text-align: center;
      color: #084a58;
    }

    .header h2 {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 0.5rem;
    }

    .header p {
      font-size: 16px;
      color: #084a58;
      max-width: 700px;
      margin: 0 auto;
    }

    .layout {
      display: flex;
      gap: 2rem;
      align-items: flex-start;
      margin-top: 2rem;
    }

    .form-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      flex: 1;
    }

    .form-container label {
      display: block;
      margin-bottom: 1rem;
    }

    .form-container strong {
      display: block;
      margin-bottom: 0.25rem;
    }

    input[type="text"], textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: inherit;
    }

    .button-bar {
      margin-top: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .nav-button {
      background-color: #084a58;
      color: white;
      border: none;
      padding: 0.5rem 1.2rem;
      font-size: 0.95rem;
      font-family: inherit;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
      cursor: pointer;
      border-radius: 4px;
    }

    .nav-button:hover {
      background-color: #0a5c6a;
    }

    #status {
      margin-top: 1rem;
      font-weight: 600;
      color: #084a58;
    }
  </style>
</head>
<body>

  <div class="header">
    <h2>Exercise 2 ‚Äì Page 31</h2>
    <p>
      Type in the boxes below a description of the stakeholder's identity (who they are at their deepest level), ambition (an aspiration or dream big or small), and role (in particular in the relationship with you.) These are important relationship and reputation insights about your stakeholders' wants and needs ‚Äì from their points of view.
    </p>
  </div>

  <div class="layout">
    <img src="/page-31.jpg" alt="Exercise Page" style="max-width: 45%; border-radius: 8px; border: 1px solid #ccc;" />

    <form id="exercise-form" class="form-container">
      <label>
        <strong>Stakeholder #6 (use the name/description from the last exercise)</strong>
        <input type="text" id="stakeholder" required />
      </label>

      <label>
        <strong>Identity</strong>
        <textarea id="identity" rows="4"></textarea>
      </label>

      <label>
        <strong>Ambition</strong>
        <textarea id="ambition" rows="4"></textarea>
      </label>

      <label>
        <strong>Role</strong>
        <textarea id="role" rows="4"></textarea>
      </label>

      <div class="button-bar">
        <button type="button" class="nav-button" onclick="goBack()">‚¨Ö Back One Page</button>
        <button type="button" class="nav-button" onclick="saveData()">üíæ Save</button>
        <button type="button" class="nav-button" onclick="saveAndGoNext()">‚û° Save & Next</button>
        <button type="button" class="nav-button" onclick="window.print()">üñ®Ô∏è Print</button>
        <button type="button" class="nav-button" onclick="window.location.href='/page-3.html'">Go to the Table of Contents</button>
      </div>

      <div id="status"></div>
    </form>
  </div>

  <script>
    const supabase = window.supabase.createClient(
      'https://nidxvthbowdgdfuopmzk.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5pZHh2dGhib3dkZ2RmdW9wbXprIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQxNTYwMjgsImV4cCI6MjA1OTczMjAyOH0.EaRbqF0WYFzYfjL5A6ykQKzHCZzCNPWJINIVwosqYk4'
    );

    let user = null;

    window.addEventListener('DOMContentLoaded', async function () {
      const response = await supabase.auth.getUser();
      user = response.data.user;
      if (!user) return;

      const { data } = await supabase
        .from('exercise2_page31')
        .select('*')
        .eq('user_id', user.id)
        .single();

      if (data) {
        document.getElementById("stakeholder").value = data.stakeholder || "";
        document.getElementById("identity").value = data.identity || "";
        document.getElementById("ambition").value = data.ambition || "";
        document.getElementById("role").value = data.role || "";
      }
    });

    window.saveData = async function () {
      const stakeholder = document.getElementById("stakeholder").value.trim();
      const identity = document.getElementById("identity").value.trim();
      const ambition = document.getElementById("ambition").value.trim();
      const role = document.getElementById("role").value.trim();

      const { error } = await supabase.from("exercise2_page31").upsert([
        { user_id: user.id, stakeholder, identity, ambition, role }
      ], { onConflict: ['user_id'] });

      const statusMsg = document.getElementById("status");
      if (error) {
        statusMsg.textContent = "‚ùå Error saving data: " + error.message;
        statusMsg.style.color = "red";
      } else {
        statusMsg.textContent = "Saved successfully!";
        statusMsg.style.color = "#084a58";
      }
    };

    window.saveAndGoNext = async function () {
      await saveData();
      window.location.href = "/#page/32.html";
    };

    window.goBack = function () {
      window.location.href = "/page-30.html";
    };
  </script>

</body>
</html>
